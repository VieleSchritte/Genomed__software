{% extends "../base.html" %}

{% block html_title %}
    {{ block.super }} — Cognation
{% endblock %}

{% block title %}
    Cognation
{% endblock title %}

{% block content %}
    {{ block.super }}
    <form action="{% url 'cognation:calculate' %}" method="post" id="cognationForm" class="text-dark">
        <div class="wrapper">
            <div>
                <h1 id="start-header">Выберите тип родства:</h1>
            </div>
            {% load static %}
            <div id="select-formula">
                <div class="but-bunch" data-toggle="buttons">
                    {% for f in formulas %}
                        <label class="cognation-button" title="{{ f.name }}">
                            <input type="radio" class="target" name="type" value="{{ f.value }}"/> {{ f.name }}
                        </label>
                        <div class="description-genotypes">
                            <div class="description">
                                <h2 class="description-header">
                                    {{ f.name }}
                                </h2>
                                <img src="{% static f.image %}" class="description-image"
                                     alt="{{ f.name }}">
                                <div class="text-buttons">
                                    <p class="description-text">
                                        {{ f.desc }}
                                    </p>
                                    <div class="ok-back-buttons">
                                        <label class="description-button description-back">
                                            <input type="button" value="Назад">Назад
                                        </label>
                                        <label class="description-button description-ok">
                                            <input type="button" value="OK">OK
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="all-genotypes">
                                <div class="first-genotype">
                                    <h2 class="genotype-header">
                                        {{ f.parts.1 }}
                                    </h2>
                                    <label>
                                        <textarea name="{{ f.names.0 }}" cols="120" rows="24" class="form-control"></textarea>
                                    </label>
                                    {% csrf_token %}
                                    <div class="genotype-button-group">
                                        <label class="genotype-button first-back">
                                            <input type="button" value="Назад">Назад
                                        </label>
                                        <label class="genotype-button genotype-next">
                                            <input type="button" value="Далее">Далее
                                        </label>
                                    </div>
                                </div>
                                {% if f.parts.0 == 2%}
                                    <div class="add-genotype">
                                        <h2 class="genotype-header">
                                            {{ f.parts.2 }}
                                        </h2>
                                        <label>
                                            <textarea name="{{ f.names.1 }}" cols="120" rows="24" class="form-control"></textarea>
                                        </label>
                                        <div class="genotype-button-group">
                                            <label class="genotype-button genotype-back">
                                                <input type="button" value="Назад">Назад
                                            </label>
                                            <button class="genotype-button genotype-submit">
                                                Рассчитать
                                            </button>
                                        </div>
                                    </div>
                                {% endif %}
                                {% if f.parts.0 == 3 %}
                                    <div class="add-genotype">
                                        <h2 class="genotype-header">
                                            {{ f.parts.2 }}
                                        </h2>
                                        <label>
                                            <textarea name="{{ f.names.1 }}" cols="120" rows="24" class="form-control"></textarea>
                                        </label>
                                        <div class="genotype-button-group">
                                            <label class="genotype-button genotype-back">
                                                <input type="button" value="Назад">Назад
                                            </label>
                                            <label class="genotype-button genotype-next">
                                                <input type="button" value="Назад">Далее
                                            </label>
                                        </div>
                                    </div>
                                    <div class="add-genotype">
                                        <h2 class="genotype-header">
                                            {{ f.parts.3 }}
                                        </h2>
                                        <label>
                                            <textarea name="{{ f.names.2 }}" cols="120" rows="24" class="form-control"></textarea>
                                        </label>
                                        <div class="genotype-button-group">
                                            <label class="genotype-button genotype-back">
                                                <input type="button" value="Назад">Назад
                                            </label>
                                            <button class="genotype-button genotype-submit">
                                                Рассчитать
                                            </button>
                                        </div>
                                    </div>
                                {% endif %}
                                {% if f.parts.0 == 4 %}
                                    <div class="add-genotype">
                                        <h2 class="genotype-header">
                                            {{ f.parts.2 }}
                                        </h2>
                                        <label>
                                            <textarea name="{{ f.names.1 }}" cols="120" rows="24" class="form-control"></textarea>
                                        </label>
                                        <div class="genotype-button-group">
                                            <label class="genotype-button genotype-back">
                                                <input type="button" value="Назад">Назад
                                            </label>
                                            <label class="genotype-button genotype-next">
                                                <input type="button" value="Назад">Далее
                                            </label>
                                        </div>
                                    </div>
                                    <div class="add-genotype">
                                        <h2 class="genotype-header">
                                            {{ f.parts.3 }}
                                        </h2>
                                        <label>
                                            <textarea name="{{ f.names.2 }}" cols="120" rows="24" class="form-control"></textarea>
                                        </label>
                                        <div class="genotype-button-group">
                                            <label class="genotype-button genotype-back">
                                                <input type="button" value="Назад">Назад
                                            </label>
                                            <label class="genotype-button genotype-next">
                                                <input type="button" value="Назад">Далее
                                            </label>
                                        </div>
                                    </div>
                                    <div class="add-genotype">
                                        <h2 class="genotype-header">
                                            {{ f.parts.4 }}
                                        </h2>
                                        <label>
                                            <textarea name="{{ f.names.3 }}" cols="120" rows="24" class="form-control"></textarea>
                                        </label>
                                        <div class="genotype-button-group">
                                            <label class="genotype-button genotype-back">
                                                <input type="button" value="Назад">Назад
                                            </label>
                                            <button class="genotype-button genotype-submit">
                                                Рассчитать
                                            </button>
                                        </div>
                                    </div>
                                {% endif %}
                                {% if f.parts.0 == 5 %}
                                    <div class="add-genotype">
                                        <h2 class="genotype-header">
                                            {{ f.parts.2 }}
                                        </h2>
                                        <label>
                                            <textarea name="{{ f.names.1 }}" cols="120" rows="24" class="form-control"></textarea>
                                        </label>
                                        <div class="genotype-button-group">
                                            <label class="genotype-button genotype-back">
                                                <input type="button" value="Назад">Назад
                                            </label>
                                            <label class="genotype-button genotype-next">
                                                <input type="button" value="Назад">Далее
                                            </label>
                                        </div>
                                    </div>
                                    <div class="add-genotype">
                                        <h2 class="genotype-header">
                                            {{ f.parts.3 }}
                                        </h2>
                                        <label>
                                            <textarea name="{{ f.names.2 }}" cols="120" rows="24" class="form-control"></textarea>
                                        </label>
                                        <div class="genotype-button-group">
                                            <label class="genotype-button genotype-back">
                                                <input type="button" value="Назад">Назад
                                            </label>
                                            <label class="genotype-button genotype-next">
                                                <input type="button" value="Назад">Далее
                                            </label>
                                        </div>
                                    </div>
                                    <div class="add-genotype">
                                        <h2 class="genotype-header">
                                            {{ f.parts.4 }}
                                        </h2>
                                        <label>
                                            <textarea name="{{ f.names.3 }}" cols="120" rows="24" class="form-control"></textarea>
                                        </label>
                                        <div class="genotype-button-group">
                                            <label class="genotype-button genotype-back">
                                                <input type="button" value="Назад">Назад
                                            </label>
                                            <label class="genotype-button genotype-next">
                                                <input type="button" value="Назад">Далее
                                            </label>
                                        </div>
                                    </div>
                                    <div class="add-genotype">
                                        <h2 class="genotype-header">
                                            {{ f.parts.5 }}
                                        </h2>
                                        <label>
                                            <textarea name="{{ f.names.4 }}" cols="120" rows="24" class="form-control"></textarea>
                                        </label>
                                        <div class="genotype-button-group">
                                            <label class="genotype-button genotype-back">
                                                <input type="button" value="Назад">Назад
                                            </label>
                                            <button class="genotype-button genotype-submit">
                                                Рассчитать
                                            </button>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <script>

            /* Behaviour of radio buttons - on click on one of them show its description and hide the rest of buttons */
            for (let label of document.querySelectorAll('label.cognation-button')) {
                label.onclick = HideFormulaButtons
            }

            function HideFormulaButtons(event) {
                let descriptionGenotypes = event.target.nextElementSibling;
                descriptionGenotypes.style.display = 'block';
                let startHeader = document.getElementById('start-header')
                startHeader.style.display = 'none';

                for (let label of document.querySelectorAll('label.cognation-button')) {
                    label.style.display = 'none';
                }
            }

            /* On click on back button - hide description and show the rest of radio buttons */
            for (let backButton of document.querySelectorAll('label.description-back')) {
                backButton.onclick = function OnBackButtonClick() {
                    backButton.closest('.description-genotypes').style.display = 'none';

                    for (let label of document.querySelectorAll('label.cognation-button')) {
                        label.style.display = 'inline';
                        label.classList.remove("active");
                        let startHeader = document.getElementById('start-header');
                        startHeader.style.display = 'block';
                    }
                }
            }

            /* On click on ok button in a description - hide description and label, show first field fof genotype, hide start header */
            for (let okButton of document.querySelectorAll('label.description-ok')) {
                okButton.onclick = function OnOKButtonClick() {
                    /* hiding label */
                    let labelToHide = okButton.closest('.description-genotypes').previousElementSibling;
                    labelToHide.style.display = 'none';

                    /* hiding description */
                    let cognDescr = okButton.closest('.description')
                    cognDescr.style.display = 'none';

                    /* hiding start header */
                    document.getElementById('start-header').style.display = 'none';

                    /* showing first field for genotype */
                    let addGenotype = cognDescr.nextElementSibling.firstElementChild;
                    addGenotype.style.display = 'block';
                }
            }

            /* First child back - hides itself, shows description */
            for (let allGenotypes of document.querySelectorAll('div.all-genotypes')) {
                let buttonGroup = allGenotypes.querySelector('div.first-genotype').querySelector('div.genotype-button-group');
                let firstBackButton = buttonGroup.querySelector('label.first-back');
                firstBackButton.onclick = function firstBackButtonBehaviour() {
                    let firstGenotype = allGenotypes.firstElementChild;
                    firstGenotype.style.display = 'none';

                    let description = allGenotypes.previousElementSibling;
                    description.style.display = 'block';
                }
            }

            /* All other back buttons - hide themselves, show previous genotypes */
            for (let genotypeBackButton of document.querySelectorAll('label.genotype-back')) {
                let buttonGroup = genotypeBackButton.closest('.genotype-button-group');
                let currentGenotype = buttonGroup.parentElement;
                let previousGenotype = currentGenotype.previousElementSibling;
                genotypeBackButton.onclick = function OnBackClick() {
                    currentGenotype.style.display = 'none';
                    previousGenotype.style.display = 'block';
                }
            }

            /* Next button always shows next genotype */
            for (let genotypeNextButton of document.querySelectorAll('label.genotype-next')) {
                let buttonGroup = genotypeNextButton.closest('.genotype-button-group');
                let currentGenotype = buttonGroup.parentElement;
                let nextGenotype = currentGenotype.nextElementSibling;
                genotypeNextButton.onclick = function OnNextClick() {
                    currentGenotype.style.display = 'none';
                    nextGenotype.style.display = 'block';
                }
            }

        </script>
    </form>
{% endblock content %}